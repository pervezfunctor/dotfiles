#!/usr/bin/env bash

# shellcheck disable=SC1090
source <(curl -sSL https://raw.githubusercontent.com/pervezfunctor/dotfiles/refs/heads/main/share/utils)

INSTALL_OPTIONS=(
  "work"
  "shell-slim"
  "shell"
  "vscode"
  "terminal"
  "docker"
  "vm"
  "dev"
  "nix"
  "dev-nix"
  "brew"
  "home-manager"
  "web"
)

help() {
  echo "Usage: $0 [OPTION]"
  echo "Options:"
  echo "  work            shell, vscode, docker and terminal app."
  echo "  shell-slim      essential shell packages."
  echo "  shell           shell, and terminal app."
  echo "  vscode          vscode and extensions."
  echo "  terminal        terminal app and nerd fonts."
  echo "  vm              libvirt, virt-manager and gnome-boxes."
  echo "  dev             shell-slim, vscode, libvirt, distrobox and terminal app."
  echo "  nix             nix installation with home-manager."
  echo "  dev-nix         nix installation with home-manager and vscode."
  echo "  help            shows this help."
  echo ""
}

installer() {
  if ! [[ "$#" -eq 0 ]]; then
    for arg in "$@"; do
      if fn_exists "${arg}_groupstall"; then
        "${arg}_groupstall"
      elif fn_exists "${arg}_install"; then
        "${arg}_install"
      else
        warn "No such installer: $arg"
      fi
    done
  fi
}

main() {
  if ! [[ "$#" -eq 0 ]]; then
    installer "$@"
    return 0
  fi

  if ! has_cmd gum && ! has_cmd fzf; then
    help
    exit 0
  fi

  local SELECTED_OPTIONS
  SELECTED_OPTIONS=$(select-multi "Choose options to install" "${INSTALL_OPTIONS[@]}")

  if [[ -n "$SELECTED_OPTIONS" ]]; then
    echo ""
    slog "Installing ${SELECTED_OPTIONS}..."
    echo ""
    installer "$SELECTED_OPTIONS"
  else
    slog "No option selected."
    return 1
  fi
}

if [[ "$1" == "help" || "$1" == "-h" || "$1" == "--help" ]]; then
  help
else
  CLICOLOR_FORCE=1 bootstrap "$@"
fi
