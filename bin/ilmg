#!/usr/bin/env bash

# shellcheck disable=SC1090
source <(curl -sSL https://raw.githubusercontent.com/pervezfunctor/dotfiles/refs/heads/main/share/utils)

# all options
# "base" "min" "shell-slim" "shell" "dev" "vbox-dev" "vm" "prog" "all" "nix" "sway" "hyprland" "slimbox" "box" "fullbox" "dbox" "nixbox" "tw-wslbox" "nixos-wslbox" "wslbox" "wsl" "centos-wsl" "centos-fast" "generic-ct" "generic" "fedora-atomic-tbox" "ublue" "fedora-atomic" "fedora-layered" "dbox-docker-dev" "box-default" "box-default-atomic"

INSTALL_OPTIONS=(
    "work"
    "shell-slim"
    "shell"
    "vm"
    "dev"
    "dev-full"
    # "docker"
    # "distrobox"
    # "nix"
    # "vm"
    # "vscode"
    # "hyprland"
    # "sway"
)

help() {
    echo "Usage: $0 [OPTION]"
    echo "Options:"
    echo "  work            shell, vscode, docker and terminal app."
    echo "  shell-slim      essential shell packages."
    echo "  shell           shell, and terminal app."
    echo "  vm              libvirt, virt-manager and gnome-boxes."
    echo "  dev             shell-slim, vscode, libvirt, distrobox and terminal app."
    echo "  dev-full        dev with nix and incus."
    echo "  help            shows this help."
    echo ""
}

main() {
    if ! [[ "$#" -eq 0 ]]; then
        "${1}_mainstall"
        return 0
    fi

    if ! has_cmd gum; then
        help
        exit 0
    fi

    local SELECTED_OPTION
    SELECTED_OPTION=$(gum choose --header "Choose option to install" "${INSTALL_OPTIONS[@]}")

    if [[ -n "$SELECTED_OPTION" ]]; then
        echo ""
        slog "Installing $SELECTED_OPTION..."
        echo ""
        "${SELECTED_OPTION}_mainstall"
        slog "Installation complete."
    else
        slog "No option selected."
        return 1
    fi
}

if [[ "$1" == "help" || "$1" == "-h" || "$1" == "--help" ]]; then
    help
else
    CLICOLOR_FORCE=1 bootstrap "$@"
fi
