function rev-stash() {
    if git stash apply; then
        git stash drop
        cd "$cur_dir" || return 1
    else
        git reset --hard $current_branch
        git stash apply && git stash drop
    fi
}

origin-same() {
    local current_branch=$(git rev-parse --abbrev-ref HEAD)
    git diff --quiet origin/"$current_branch"
}

function git-up() {
    cd "$1" || return 1

    local cur_dir=$(pwd)

    origin-same && return 0

    git stash --include-untracked
    STASHED=$?

    git pull --rebase || git rebase --abort

    [[ $STASHED == 0 ]]  && rev-stash

    cd "$cur_dir" || return 1
}
