#!/usr/bin/env bash

# shellcheck disable=SC1091

set -euo pipefail -o errtrace

# Source the tmux-utils script to get access to the tmux_windows function
source "$(dirname "$0")/tmux-utils"

usage() {
  cat <<EOF
Usage: $(basename "$0") <session-name> <name1> <command1> [<name2> <command2> ...]

Create a tmux session with multiple named windows, where each window runs a command.
Each name-command pair will create a window with the specified name running the command.

Arguments:
  session-name      Name for the tmux session
  name1             Name for the first window
  command1          Command to run in the first window
  name2             Name for the second window (optional)
  command2          Command to run in the second window (optional)

Examples:
  $(basename "$0") my-system "monitor" "htop" "logs" "tail -f /var/log/syslog"
  $(basename "$0") servers "web1" "ssh web1.example.com" "db1" "ssh db1.example.com"
EOF
}

main() {
  if [ "$#" -lt 3 ] || [ $(($# % 2)) -eq 0 ]; then
    usage
    exit 1
  fi

  local session_name="$1"
  shift

  # Call the tmux_windows function from tmux-utils
  tmux_windows "$session_name" "$@"
}

main "$@"
