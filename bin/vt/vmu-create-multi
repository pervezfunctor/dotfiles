#!/usr/bin/env bash

set -euo pipefail

# shellcheck disable=SC1091
source "$(dirname "$0")/vm-utils"
# shellcheck disable=SC1091
source "$(dirname "$0")/vt-utils"

ALL_DISTRIBUTIONS=("alpine" "debian" "ubuntu" "fedora" "arch" "tw" "centos")

create_all_vms() {
  # shellcheck disable=SC2034
  local additional_args=("$@")
  create_all_vt "vmu-create" SELECTED_DISTRIBUTIONS additional_args
}

main() {
  if [[ "${1:-}" == "--help" || "${1:-}" == "-h" ]]; then
    vmu-create --help
    exit 0
  fi

  # shellcheck disable=SC2034
  mapfile -t SELECTED_DISTRIBUTIONS < <(select_distributions "${ALL_DISTRIBUTIONS[@]}")

  create_all_vms "$@"
}

main "$@"
