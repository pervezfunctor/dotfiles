#!/usr/bin/env bash

set -euo pipefail -o errtrace

# shellcheck disable=SC1091
source "$(dirname "$0")/dt-utils"
# shellcheck disable=SC1091
source "$(dirname "$0")/vt-utils"

ALL_DISTRIBUTIONS=("ubuntu" "arch" "fedora" "tw" "nix" "centos" "alpine")

create_all_vms() {
  # shellcheck disable=SC2034
  local additional_args=("$@")
  create_all_vt "dt create" SELECTED_DISTRIBUTIONS additional_args
}

main() {
  if [[ $# -eq 0 ]]; then
    dt --help
    exit 1
  fi
  if [[ "$1" == "--help" || "$1" == "-h" ]]; then
    dt --help
    exit 0
  fi

  # shellcheck disable=SC2034
  mapfile -t SELECTED_DISTRIBUTIONS < <(select_distributions "${ALL_DISTRIBUTIONS[@]}")

  create_all_vms "$@"
}

main "$@"
