#!/usr/bin/env bash

set -euo pipefail

# shellcheck disable=SC1091
source "$(dirname "$0")/vm-utils"

ALL_DISTRIBUTIONS=("arch" "ubuntu" "debian" "fedora" "tumbleweed" "centos" "rocky" "alpine")

create_all_vms() {
  # shellcheck disable=SC2034
  local additional_args=("$@")
  create_all_vt "vme-create" SELECTED_DISTRIBUTIONS additional_args
}

main() {
  if [[ $# -eq 0 ]]; then
    vme-create --help
    exit 1
  fi
  if [[ "$1" == "--help" || "$1" == "-h" ]]; then
    vme-create --help
    exit 0
  fi

  # shellcheck disable=SC2034
  mapfile -t SELECTED_DISTRIBUTIONS < <(select_distributions "${ALL_DISTRIBUTIONS[@]}")

  create_all_vms "$@"
}

main "$@"
