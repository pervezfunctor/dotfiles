# SSH Hardened Configuration
# Place this file in /etc/ssh/sshd_config.d/
#
# This configuration implements security best practices for SSH daemon
# Restart SSH service after applying: systemctl restart sshd

# ==================== Protocol Settings ====================

# Use only SSH protocol 2 (SSH-1 is deprecated and insecure)
Protocol 2

# ==================== Authentication Settings ====================

# Disable root login - use sudo instead
PermitRootLogin no

# Disable empty passwords
PermitEmptyPasswords no

# Require at least one authentication method
AuthenticationMethods "publickey,password"

# Set maximum authentication attempts
MaxAuthTries 3

# Set authentication timeout
LoginGraceTime 30

# Enable public key authentication
PubkeyAuthentication yes

# Disable password authentication if you prefer key-only auth
# Uncomment the line below for key-only authentication
PasswordAuthentication no

# ==================== Key Exchange and Ciphers ====================

# Restrict key exchange algorithms to secure ones
KexAlgorithms curve25519-sha256@libssh.org,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,diffie-hellman-group14-sha256

# Use only secure ciphers
Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr

# Use only secure MAC algorithms
MACs umac-128-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,umac-128@openssh.com,hmac-sha2-256,hmac-sha2-512

# ==================== Security Settings ====================

# Disable forwarding for security
X11Forwarding no
AllowTcpForwarding no
GatewayPorts no

# Disable tunneling
PermitTunnel no

# Disable agent forwarding
AllowAgentForwarding no

# Disable rhosts authentication
IgnoreRhosts yes

# Ignore .rhosts and .shosts files
HostbasedAuthentication no

# Disable sftp subsystem if not needed
# Subsystem sftp /usr/lib/openssh/sftp-server

# ==================== Logging and Monitoring ====================

# Enable verbose logging
LogLevel VERBOSE

# Log additional information
SyslogFacility AUTHPRIV

# ==================== Connection Settings ====================

# Set maximum number of concurrent sessions
MaxSessions 2

# Set maximum number of unauthenticated connections
MaxStartups 10:30:60

# Enable TCP keep alive
TCPKeepAlive yes

# Set client alive interval and count to detect dead connections
ClientAliveInterval 300
ClientAliveCountMax 2

# ==================== Access Control ====================

# Restrict access to specific users or groups
# AllowUsers username1 username2
# AllowGroups groupname1 groupname2
# DenyUsers username3
# DenyGroups groupname2

# ==================== Banner ====================

# Display a warning banner before login
# Banner /etc/ssh/banner.txt

# ==================== Additional Hardening ====================

# Disable sftp if not needed
# Subsystem sftp /usr/lib/openssh/sftp-server

# Use privilege separation
UsePrivilegeSeparation yes

# Strict modes for file permissions
StrictModes yes

# ==================== Rekey Limits ====================

# Set rekey limits for enhanced security
RekeyLimit 1G 1h
