#! /usr/bin/env bash

{

if [[ -z "$DOT_DIR" ]]; then
    err_exit "DOT_DIR not set."
else
    source "$DOT_DIR/utils"
fi

source "$DOT_DIR/stow/.local/share/fns"

OPTIONS=("ubuntu" "debian" "arch" "fedora" "tumbleweed" "rocky" "bluefin" "bluefin-all" "toolboxes")

help() {
    echo "Usage: $0 [OPTION]"
    echo "Options:"
    echo "  ubuntu      Ubuntu distrobox."
    echo "  debian      Debian distrobox."
    echo "  arch        Arch distrobox."
    echo "  fedora      Fedora distrobox."
    echo "  rocky       Rocky Linux distrobox."
    echo "  tumbleweed  OpenSUSE Tumbleweed distrobox."
    echo "  bluefin     Bluefin distrobox."
    echo "  bluefin-all All bluefin defined distroboxes(bluefin, wolfi, fedora, arch, ubuntu)."
    echo "  toolboxes   All distroboxes from toolbox images(ubuntu, fedora, arch, centos, debian, rocky)."
    echo ""
}

installer() {
    slog "Installing $1 distrobox"

    if [[ "$1" == "bluefin" ]]; then
        distrobox_ublue_all
        return 0
    elif [[ "$1" == "toolboxes" ]]; then
        distrobox_toolbox_all
        return 0
    elif has_cmd "distrobox_create_$1"; then
        "distrobox_create_$1"
        return 0
    else
        err_exit "No installer found for $1"
    fi
}

main() {
    if ! [[ "$#" -eq 0 ]]; then
        installer $1
        exit 0
    fi

    if ! has_cmd gum; then
        help
        exit 1
    fi

    SELECTED_OPTION=$(gum choose "${OPTIONS[@]}" --header "Choose option to install" | tr '\n' ' ')

    if [[ -n "$SELECTED_OPTION" ]]; then
        echo ""
        echo "Selected: $SELECTED_OPTION"
        echo ""
        bluefin
    else
        slog "No option selected."
        exit 1
    fi
}

CLICOLOR_FORCE=1 bootstrap "$@"

}
