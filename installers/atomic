#! /usr/bin/env bash

{

source <(curl -sSL https://dub.sh/z3pTnAK)

vscode_flatpak_install() {
    fpi com.visualstudio.code
    fpi com.visualstudio.code.tool.podman
    alias code="flatpak run com.visualstudio.code"
    cat $DOT_DIR/extras/vscode/extensions/common | xargs -L 1 flatpak run com.visualstudio.code --install-extension
}

nix_install() {
    curl --proto '=https' --tlsv1.2 -sSf -L https://install.determinate.systems/nix | sh -s -- install --determinate
    . /nix/var/nix/profiles/default/etc/profile.d/nix-daemon.sh

    nix-channel --add https://nixos.org/channels/nixpkgs-unstable nixpkgs
    # nix-channel --add https://github.com/nix-community/home-manager/archive/master.tar.gz home-manager
    nix-channel --update
    # nix-shell '<home-manager>' -A install
    nix-env -iA nixpkgs.gtop
}

atomic_python_install() {
    python3 -m ensurepip --upgrade
    python3 -m pip install --upgrade pip
    python3 -m pip install --upgrade pipx
    python3 -m pip install --upgrade uv
    pipx install trash-cli
}

main() {
    appman_install
    mise_install

    mise_shell_install
    if has_cmd nu && ! grep -q 'has_cmd nu && nu'; then
        echo "has_cmd nu && nu"
    fi

    amm_shell_install
    nerd_font_install
    vscode_flatpak_install
    config_install
}

bootstrap "Immutable OS"

}
